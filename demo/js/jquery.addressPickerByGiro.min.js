var bg=bg||!1;bg||"undefined"!=typeof jQuery?bg=jQuery:(bg=angular.element,bg.extend=angular.extend),function(e){"use strict";function t(e,t,n){clearTimeout(o[n]),o[n]=setTimeout(e,t)}function n(t){var n,a=this,t=t||this.addressMapping[this.$element.val()];if(t){for(var r in this.settings.boundElements){if(!e(r))return!0;var i=this.settings.boundElements[r];n=e(r);var o="";"function"==typeof i?o=i.call(a,t):t.cleanData&&t.cleanData[i]&&(o=t.cleanData[i]);for(var s=n.length,r=0;s>r;r++){var d="val",g=n.eq(r);g.is("input, select, textarea")||(d="text"),g[d](o)}}a.$element.triggerHandler("selected.addressPickerByGiro",t)}}function a(){var t=this,n=e.extend({},t.settings.mapOptions);n.center=new google.maps.LatLng(n.center[0],n.center[1]);var a={position:n.center,draggable:!0,raiseOnDrag:!0,map:t.gmap,labelContent:t.settings.text.you_are_here,labelAnchor:new google.maps.Point(0,0),labelClass:t.settings.markerLabelClass,labelStyle:{opacity:1}};if("styled"==t.settings.markerType&&"function"==typeof StyledMarker){var r=new StyledIcon(StyledIconTypes.BUBBLE,{color:"#51A351",fore:"#ffffff",text:t.settings.text.you_are_here});a.styleIcon=r,t.gmarker=new StyledMarker(a)}else t.gmarker="labeled"==t.settings.markerType&&"function"==typeof MarkerWithLabel?new MarkerWithLabel(a):new google.maps.Marker(a);google.maps.event.addListener(t.gmarker,"dragend",function(){t.geocodeLookup(t.gmarker.getPosition(),!1,"latLng",!0)}),google.maps.event.addListener(t.gmap,"click",function(e){t.gmarker.setPosition(e.latLng),t.geocodeLookup(e.latLng,!1,"latLng",!0)}),this.gmarker.setVisible(!1)}function r(){var t,n=this,a=e.extend({},n.settings.mapOptions);a.center=new google.maps.LatLng(a.center[0],a.center[1]),t&&(t=1e3*t),t=t||n.settings.distanceWidgetRadius;var r=new google.maps.Circle({center:a.center,radius:t,strokeColor:"#005DE0",strokeOpacity:.8,strokeWeight:2,fillColor:"#005DE0",fillOpacity:.25,map:n.gmap}),i=function(){r.setEditable(!0)},o=function(){r.setEditable(!1)};n.gcircle=r,n.gcircle.setVisible(!1),google.maps.event.addListener(n.gcircle,"radius_changed",function(){n.updater()}),google.maps.event.addListener(n.gcircle,"mouseover",i),google.maps.event.addListener(n.gcircle,"mouseout",o),n.gcircle.bindTo("center",n.gmarker,"position")}var i,o={};i={init:function(t,n){var a=this;a.$element=t,a.settings=e.extend({},{map:!1,mapId:!1,mapWidth:"100%",mapHeight:"300px",mapOptions:{zoom:3,center:[51.751724,-1.255284],scrollwheel:!1,mapTypeId:"roadmap"},makerType:!1,distanceWidget:!1,distanceWidgetRadius:3e4,appendToAddressString:"",geocoderOptions:{language:"en"},typeaheadOptions:{source:a.source,updater:a.updater,matcher:function(){return!0}},boundElements:{},text:{you_are_here:"You are here!"},map_rendered:!1},n);for(var r in a.settings.typeaheadOptions){var i=a.settings.typeaheadOptions[r];"function"==typeof i&&(a.settings.typeaheadOptions[r]=i.bind(a))}a.addressMapping={},a.currentItem="",a.geocoder=new google.maps.Geocoder,a.initMap.apply(a,void 0),"function"==typeof a.$element.typeahead&&a.$element.attr("autocomplete","off").typeahead(a.settings.typeaheadOptions),""!=a.$element.val()&&a.geocodeLookup(a.$element.val(),!1,"",!0)},initMap:function(){var t,n=this;if(n.settings.mapId||n.settings.map instanceof google.maps.Map?t=e(n.settings.mapId):(n.settings.mapId=(new Date).getTime()+Math.floor(9999999*Math.random()+1),t=e('<div style="margin: 5px 0; width: '+n.settings.mapWidth+"; height: "+n.settings.mapHeight+';" id="'+n.settings.mapId+'"></div>'),n.$element.after(t)),1==n.map_rendered)return void n.resizeMap();var i=e.extend({},n.settings.mapOptions);this.settings.map instanceof google.maps.Map?this.gmap=this.settings.map:(i.center=new google.maps.LatLng(i.center[0],i.center[1]),this.gmap=new google.maps.Map(t[0],i)),a.call(this),this.settings.distanceWidget&&r.call(this),n.map_rendered=!0},source:function(e,n){var a,r=this,i=function(i){t(function(){r.geocodeLookup(e,function(e){r.addressMapping={},a=[];for(var t=e.length,o=0;t>o&&9>o;o++){var s=e[o];r.addressMapping[s.formatted_address]=s,a.push(s.formatted_address)}return"function"==typeof i&&i(a),"function"==typeof n?n(a):void 0})},250,"source")};return window.Promise?new Promise(i):void i()},updater:function(e){var t,a=this,e=e||a.$element.val(),r=this.addressMapping[e]||{},i={},o=r.geometry.location;if(r){if(t={country:{long_name:"country",short_name:"country_code"},administrative_area_level_1:{long_name:"region",short_name:"region_code"},administrative_area_level_2:{long_name:"county",short_name:"county_code"},locality:{long_name:"city"},sublocality:{long_name:"city_district"},postal_code:{long_name:"zip"},route:{long_name:"street"},street_number:{long_name:"street_number"}},r.address_components)for(var s=0;s<r.address_components.length;s++){var d=r.address_components[s];for(var g in t)if(d.types.indexOf(g)>=0)for(var l in t[g])"undefined"!=typeof d[l]&&(i[t[g][l]]=d[l])}return i.latitude=Number(o.lat().toFixed(8)),i.longitude=Number(o.lng().toFixed(8)),i.formatted_address=r.formatted_address,a.gmarker&&(a.gmarker.setPosition(r.geometry.location),a.gmarker.setVisible(!0)),a.gcircle&&(a.gcircle.setCenter(r.geometry.location),a.gcircle.setVisible(!0),i.radius=Math.round(a.gcircle.getRadius())/1e3),a.gmap.fitBounds(a.gcircle?a.gcircle.getBounds():r.geometry.viewport),r.cleanData=i,n.call(a,r),e}},currentAddress:function(){return this.addressMapping[this.$element.val()]||{}},geocodeLookup:function(t,n,a,r){r=r||!1,a=a||"";var i=this,o=e.extend({},i.settings.geocoderOptions);"latLng"==a?("string"==typeof t&&(t=t.split(","),t=new google.maps.LatLng(t[0],t[1])),o.latLng=t):o.address=t+i.settings.appendToAddressString,this.geocoder.geocode(o,function(e,t){if(t===google.maps.GeocoderStatus.OK&&("function"==typeof n&&n.call(i,e),r)){var a=e[0].formatted_address;i.$element.val(a),i.addressMapping[a]=e[0],i.updater(a)}})},resizeMap:function(n,a){var r=this;t(function(){var t,i=r.mapContainer?e(r.mapContainer):e("#"+r.mapId).parent();if(i.length){var o=i.parent(),s=o.height();w=o.width(),i.css("height",s),i.css("width",w),t="undefined"!=typeof n&&"undefined"!=typeof a?new google.maps.LatLng(n,a):r.gmap.getCenter(),google.maps.event.trigger(r.gmap,"resize"),r.gmap.setCenter(t)}},300,"resize")},setRadius:function(e){var t=this;t.gcircle&&(t.gcircle.setRadius(1e3*e),t.gmap.fitBounds(t.gcircle.getBounds()))}};var s=function(t){var n=this.data("addressPickerByGiro");if(n)return"string"==typeof t&&n[t]?n[t].apply(n,Array.prototype.slice.call(arguments,1)):console.log("Method "+t+" does not exist on jQuery.addressPickerByGiro");if(!t||"object"==typeof t){for(var a=this.length,r=0;a>r;r++){var n,o=e(this[r]);n=e.extend({},i),n.init(o,t),o.data("addressPickerByGiro",n)}return this}return console.log('jQuery.addressPickerByGiro is not instantiated. Please call $("selector").addressPickerByGiro({options})')};e.fn?e.fn.addressPickerByGiro=s:e.prototype.addressPickerByGiro=s}(bg);